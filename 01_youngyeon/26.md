# 26. ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ

# íƒœê·¸

---

#ì›¹ì• í”Œë¦¬ì¼€ì´ì…˜ê°œë°œ #spring-boot-starter-web #tomcat #jetty #undertow 

# ì§ˆë¬¸

---

1. ìŠ¤í”„ë§ë¶€íŠ¸ë¡œ ì™œ ê°œë°œí•´ì•¼ í•˜ëŠ”ê°€?
2. ìŠ¤í”„ë§ë¶€íŠ¸ë¡œ ì–´ë–»ê²Œ ê°œë°œ í•˜ëŠ”ê°€?

# ì„¤ëª…

---

# ì•„í‚¤í…ì²˜

---

![26/Untitled.png](26/Untitled.png)

## Spring MVC vs Spring Webflux

---

![26/Untitled%201.png](26/Untitled%201.png)

## Servlet vs Reactive

---

![26/Untitled%202.png](26/Untitled%202.png)

# Event Driven íë¦„ë„

---

![26/Untitled%203.png](26/Untitled%203.png)

# Boot1 vs Boot2 ì„±ëŠ¥ ë¹„êµ

---

![26/Untitled%204.png](26/Untitled%204.png)

# Response íë¦„ë„

---

## Spring MVC

---

![26/Untitled%205.png](26/Untitled%205.png)

## WebFlux

---

![26/Untitled%206.png](26/Untitled%206.png)

# íŠ¹ì§•

---

- ìŠ¤í”„ë§ë¶€íŠ¸ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ì— ìµœì í™” ë˜ì–´ ìˆë‹¤.
- ë‚´ì¥í˜• í†°ìº£, ì œí‹°, ì–¸ë”í† ìš° ë“±ì„ ì‚¬ìš©í•œ ë‚´ì¥í˜• HTTP ì„œë²„ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.(netty)
- spring-boot-starter-web ëª¨ë“ˆ ì‚¬ìš©í•˜ì—¬ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹ ë¥´ê²Œ êµ¬ì„± ì‹¤í–‰ ê°€ëŠ¥

## hello world

---

@Controller, @RestContrller, @RequestMapping ì‚¬ìš©í•˜ì—¬ HTTPì— ë§¤í•‘

    @RestController
    @RequestMapping(value="/users")
    public class MyRestController {
    
        @RequestMapping(value="/{user}", method=RequestMethod.GET)
        public User getUser(@PathVariable Long user) {
            // ...
        }
    
        @RequestMapping(value="/{user}/customers", method=RequestMethod.GET)
        List<Customer> getUserCustomers(@PathVariable Long user) {
            // ...
        }
    
        @RequestMapping(value="/{user}", method=RequestMethod.DELETE)
        public User deleteUser(@PathVariable Long user) {
            // ...
        }
    
    }

### Spring MVC ìë™ì„¤ì •

- `ContentNegotiatingViewResolver`ì™€Â `BeanNameViewResolver`Â ë¹ˆì„ í¬í•¨
- Webjarsì§€ì›ì„ í¬í•¨í•œ ì •ì  ìì› ì œê³µì„ ì§€ì›(ì¶”ê°€ë‚´ìš© ì œê³µ)
- `Converter, GenericConverter, Formatter`Â ë¹ˆì„ ìë™ë“±ë¡
- `HttpMessageConverters`Â ì§€ì›(ì¶”ê°€ë‚´ìš© ì œê³µ)
- `MessageCodeResolver`Â ìë™ ë“±ë¡(ì¶”ê°€ë‚´ìš© ì œê³µ)
- ì •ì Â `index.html`Â ì§€ì›
- `favicon`Â ë³€ê²½ ì§€ì›

ìŠ¤í”„ë§ MVC ì™„ë²½íˆ ì œì–´í•˜ê³  ì‹¶ë‹¤ë©´, @Configuration, @EnableMvc ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

ì¶”ê°€ì ì¸ MVC ì„¤ì •ì€ interceptor, formatters, viewController 

WebMvcConfigureAdapter ìœ í˜•ì˜ @Beanì„ ì¶”ê°€ í•  ìˆ˜ ìˆìŒ.

### HttpMessageConverter

ìŠ¤í”„ë§ MVCëŠ” Http ìš”ì²­ê³¼ ì‘ë‹µì„ ë³€í™˜í•˜ëŠ”ë°  HttpMessageConverter ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤. 

ìë™ Json(Jackson ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©), xml(jackson XML í™•ì¥, jaxbë¥¼ ì‚¬ìš©)

ë¬¸ìì—´ stringì€ UTF-8ë¡œ ê¸°ë³¸ ì¸ì½”ë”© í•œë‹¤. 

    import org.springframework.boot.autoconfigure.web.HttpMessageConverters;
    import org.springframework.context.annotation.*;
    import org.springframework.http.converter.*;
    
    @Configuration
    public class MyConfiguration {
    
        @Bean
        public HttpMessageConverters customConverters() {
            HttpMessageConverter<?> additional = ...
            HttpMessageConverter<?> another = ...
            return new HttpMessageConverters(additional, another);
        }
    
    }

ì‹¤ë¬´ì—ì„œëŠ”...

    @Configuration
    public class MvcConfiguration implements WebMvcConfigurer {
    
        @Value(value = "${maxAgeSeconds:1000}")
        private static final long MAX_AGE_SECONDS = 3600;
    
        @Override
        public void addInterceptors(InterceptorRegistry registry) {
            registry.addInterceptor(new RequestProcessingTimeInterceptor())
                    .addPathPatterns("/smartplanner/*")		// ì¸í„°ì…‰í„° ì ìš©í•  url
                    .excludePathPatterns("/login")	// ì¸í„°ì…‰í„° ì œì™¸í•  url
            ;
        }
    
        /**
         * coreì—ì„œ ì„¤ì •í•¨.
         * @return
         */
        @Bean
        public WebMvcConfigurer corsConfigurer() {
            return new WebMvcConfigurer() {
                @Override
                public void addCorsMappings(CorsRegistry registry) {
                    registry.addMapping("/**")
                            .allowedMethods("GET", "POST", "PUT", "DELETE")
                            .allowedOrigins("*")
                            .allowedHeaders("*")
                            .allowCredentials(true)
                            .maxAge(MAX_AGE_SECONDS);
                }
            };
        }
    
        @Bean(name = "asyncTask")
        public TaskExecutor asyncTask() {
    
            ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
            executor.setThreadNamePrefix("asyncTask-");
            executor.setCorePoolSize(5);
            executor.setMaxPoolSize(100);
            executor.setQueueCapacity(0);
            executor.setRejectedExecutionHandler(new ThreadPoolExecutor.AbortPolicy());
            return executor;
        }
    
    }

    @Bean
    public LayoutDialect layoutDialect() {
    	return new LayoutDialect();
    }
    
    @Override
    public void configureViewResolvers(ViewResolverRegistry registry) {
    	ThymeleafViewResolver resolver = new ThymeleafViewResolver();
    	resolver.setTemplateEngine(templateEngine());
    	resolver.setCharacterEncoding("UTF-8"); // <- this was added
    	resolver.setForceContentType(true); // <- this was added
    	resolver.setContentType("text/html; charset=UTF-8"); // <- this was added
    	registry.viewResolver(resolver);
    }
    
    @Bean
    public SpringTemplateEngine templateEngine() {
    	SpringTemplateEngine templateEngine = new SpringTemplateEngine();
    	templateEngine.setTemplateResolver(templateResolver());	
    	templateEngine.setEnableSpringELCompiler(true);			// Spring EL ì‚¬ìš©
    	templateEngine.addDialect(layoutDialect());
    	templateEngine.addDialect(new JSONMapperDialect());
    	return templateEngine;
    }
    
    @Bean
    public SpringResourceTemplateResolver templateResolver() {
    	SpringResourceTemplateResolver templateResolver = new SpringResourceTemplateResolver();
    	templateResolver.setCharacterEncoding("UTF-8"); // forcing UTF-8
    	templateResolver.setApplicationContext(applicationContext);	
    	templateResolver.setPrefix("classpath:/templates/");	// HTML íŒŒì¼ ìœ„ì¹˜ 
    	templateResolver.setSuffix(".html");					// HTML í™•ì¥ëª… ì‚¬ìš© 
    	templateResolver.setTemplateMode(TemplateMode.HTML);	// HTML5 ê°’ì€ ë¹„ê¶Œì¥ ë¨
    	templateResolver.setCacheable(false);					// ìºì‹œ ì‚¬ìš© ì•ˆí•¨
    	return templateResolver;
    }
    
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/static/**")			// ë¦¬ì†ŒìŠ¤ì™€ ë§¤ì¹­ë  url
        	.addResourceLocations("classpath:/static/");		// ë¦¬ì†ŒìŠ¤ ìœ„ì¹˜
        	// .setCachePeriod(60);							// ìºì‹œ ì§€ì† ì‹œê°„
            //.setCacheControl(CacheControl.maxAge(7, TimeUnit.DAYS).cachePublic());
        
        registry.addResourceHandler("/webjars/**")
        .addResourceLocations("/webjars/");
    }

MessageCodesResolver(ì˜¤ë¥˜ ë©”ì‹œì§€ì— ëŒ€í•œ ì½”ë“œ ì²˜ë¦¬)

[Validator / Error interface .... in Spring](https://ezsnote.tistory.com/entry/Validator-Error-interface-in-Spring)

### MessageCodesResolver ê°€ê¸°ì „ ì„ í–‰í•´ì•¼ í•˜ëŠ”ê²ƒë“¤

Errors ì™€ BindingResult ì¸í„°í˜ì´ìŠ¤ì˜ ì‚¬ìš©ì²˜ë¥¼ ë³´ë©´,

- Errors : ìœ íš¨ì„± ê²€ì¦ ê²°ê³¼ë¥¼ ì €ì¥í• ë•Œ ì‚¬ìš©

    ê°’ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì„ê²½ìš° reject() ë˜ëŠ” rejectValue()ë©”ì†Œë“œë¥¼ ì´ìš©í•´ì„œ ì–´ë–¤ í•„ë“œê°€ ì˜ëª»ë˜ì—ˆëŠ”ì§€, ê´€ë ¨ëœ ì—ëŸ¬ê°€ ë¬´ì—‡ì¸ì§€ ì…ë ¥ë°›ëŠ”ë‹¤.

    **reject():** ë©”ì†Œë“œëŠ” ê²€ì¦ ëŒ€ìƒ ê°ì²´ì˜ ì „ì²´ì ì¸ ì—ëŸ¬ë¥¼ ì„¤ì •. (ì´ê²Œ ê¸€ë¡œë²Œ..ì„ ì˜ë¯¸í•¨)

    **rejectValue():** ë©”ì†Œë“œëŠ” íŠ¹ì • í”„ë¡œí¼í‹°ì˜ ê²€ì¦ì—ëŸ¬ë¥¼ ì„¤ì •í•œë‹¤.

- BindingResult : Errors ì¸í„°í˜ì´ìŠ¤ì˜ í•˜ìœ„ ì¸í„°í˜ì´ìŠ¤ë¡œ í¼ ê°’ì„ ì»¤ë§¨ë“œê°ì²´ì— ë°”ì¸ë”©í•œ ê²°ê³¼ë¡œ ì €ì¥í•¨.

        @RequestMapping(method = RequestMethod.POST)
        public String submit(@Valid LoginCommand loginCommand, 
        			BindingResult result) {
        		if (result.hasErrors()) {
        			return formViewName;
        		}
        		try {
        			authenticator.authenticate(loginCommand);
        			return "redirect:/index.jsp";
        		} catch (AuthenticationException e) {
        // ì´ ê²½ìš°ì˜ ìµì…‰ì…˜ì€ ë¡œê·¸ì¸ ì‹¤íŒ¨ì´ì§€ ê°’ì´ ì—†ê±°ë‚˜ í•˜ëŠ”ê²Œ ì•„ë‹ˆë‹¤. ì¦‰ ê¹‚ì´ ì˜ëª»ëœ(ì•„ì´ë””ë‚˜ íŒ¨ìŠ¤ì›Œë“œê°€ ì˜ëª»ëœ) ê°ì²´ì˜ ë¬¸ì œì´ë‹¤.
        //  ê·¸ëŸ¬ë©´ ì•„ë˜ì²´ëŸ¼... rejectë¥¼ ì´ìš©í•´ ê¸€ë¡œë²Œì—ëŸ¬ì •ë³´(ì „ì²´ì ì¸ ì—ëŸ¬ì •ë³´) ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤ 
        			result.reject("invalidIdOrPassword", new Object[] { loginCommand.getUserId() }, null);
        			return formViewName;
        		}
        }
        
        // rejectValue ë¥¼ ì´ìš©í•˜ë©´ ê°ì²´ì˜ ê°œë³„ í”„ë¡œí¼í‹°(í•„ë“œ)ì— ëŒ€í•œ ì—ëŸ¬ì •ë³´ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.
        @Override
        public void validate(Object target, Errors errors) {
        		MemberInfo memberInfo = (MemberInfo) target;
        		if (memberInfo.getId() == null || memberInfo.getId().trim().isEmpty()) {
        			errors.rejectValue("id", "required");
        		}
        		if (memberInfo.getName() == null
        				|| memberInfo.getName().trim().isEmpty()) {
        			errors.rejectValue("name", "required");
        		}
                ....
        }

BindingResult ì¸í„°í˜ì´ìŠ¤ì˜ ê¸°ë³¸ êµ¬í˜„í´ë˜ìŠ¤(AbstractBindingResult) í´ë˜ìŠ¤ëŠ” MessageCodesResolverë¥¼ ì‚¬ìš©í•˜ì—¬ ì—ëŸ¬ì½”ë“œì— ëŒ€í•œ ì—ëŸ¬ë©”ì‹œì§€ë¥¼ ì¶”ì¶œí•œë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ DefaultMessageCodeResolverí´ë˜ìŠ¤ë¥¼ MessageCodesResolverë¡œ ì‚¬ìš©í•œë‹¤ë„¤..DefaultMessageCodeResolver ë¥¼ ì´ìš©í•´ì„œ ìë™ìœ¼ë¡œ ì—ëŸ¬ë©”ì‹œì§€ë¥¼ ìƒì„±í•˜ë ¤ë©´ MessageSourceë¥¼ ë¹ˆ ê°ì²´ë¡œ ë“±ë¡í•´ì•¼í•œë‹¨ë‹¤.

ì—ëŸ¬ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•  ë•Œì—ëŠ” ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” <form:errors> ì»¤ìŠ¤í…€ íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ë©´ëœë‹¤.ë·°ë¡œ jspë¥¼ ì‚¬ìš©í•  ê²½ìš° 2ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ì—ëŸ¬ë©”ì‹œì§€ë¥¼ ì„¤ì •í•œë‹¤.ã„±. <spring:hashBindErrors> ì»¤ìŠ¤í…€ íƒœê·¸ë¥¼ ì´ìš©í•˜ì—¬ ì—ëŸ¬ì •ë³´ë¥¼ ì„¤ì •

ìŠ¤í”„ë§ MVCëŠ” MessageCodesResolverì— ì„ ì–¸ëœ ì—ëŸ¬ë¡œë¶€í„° ì—ëŸ¬ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ê¸° ìœ„í•´ ì—ëŸ¬ì½”ë“œë¥¼ ìƒì„±í•˜ëŠ” ì „ëµì„ ê°€ì§€ê³  ìˆë‹¤. 

spring.mvc.message-codes-resolver.formatë¥¼ ì„¤ì •í•˜ì—¬ PREFIX_ERROR_CODE

[SpringBoot application.properties ì„¤ì •ê°€ëŠ¥í•œ ê²ƒë“¤ ëª¨ìŒ~ğŸµ](https://culinarydeveloper.tistory.com/24)

['ë¶„ë¥˜ ì „ì²´ë³´ê¸°' ì¹´í…Œê³ ë¦¬ì˜ ê¸€ ëª©ë¡](https://nuninaya.tistory.com/category)

    # SPRING MVC (HttpMapperProperties)
    http.mappers.json-pretty-print=false # pretty print JSON
    http.mappers.json-sort-keys=false # sort keys
    spring.mvc.locale= # set fixed locale, e.g. en_UK
    spring.mvc.date-format= # set fixed date format, e.g. dd/MM/yyyy
    spring.mvc.message-codes-resolver-format= # PREFIX_ERROR_CODE / POSTFIX_ERROR_CODE
    spring.view.prefix= # MVC view prefix
    spring.view.suffix= # ... and suffix
    spring.resources.cache-period= # cache timeouts in headers sent to browser
    spring.resources.add-mappings=true # if default mappings should be added

ê¸°ë³¸: DefaultMessageCodesResolver

    @Bean
    public LocalValidatorFactoryBean validator(MessageSource messageSource) {
      LocalValidatorFactoryBean bean = new LocalValidatorFactoryBean();
      bean.setValidationMessageSource(messageSource);
      return bean;
    }
    
    ---
    "code": "NotNull",
    "codes": [
       "NotNull.user.firstName",
       "NotNull.firstName",
       "NotNull.java.lang.String",
       "NotNull"
    ],
    
    ---
    @Autowired
    private MessageSource messageSource;
    
    @PostMapping("/users")
    public List<ObjectError> testValidation(@Valid @RequestBody User user, BindingResult bindingResult){
       bindingResult.getFieldErrors().forEach(fieldError -> new ObjectError(
       /*Assumes that ObjectError has constructor of ObjectError(String message) */
              messageSource.getMessage(fieldError, Locale.getDefault())
       ));
       return null; 
    }

messages.properties :

    NotNull.user.firstName=This doesn't work
    NotNull.firstName=Or this
    NotNull.java.lang.String=This doesn't work either
    NotNull=And this doesn't work
    
    javax.validation.constraints.NotNull.message=THIS DOES WORK! But why have codes then?

### ì •ì  ì»¨í…ì¸  Static Content

ìŠ¤í”„ë§ë¶€íŠ¸ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í´ë˜ìŠ¤íŒ¨ìŠ¤ í˜¹ì€ ServletContext ë£¨íŠ¸ì— ìˆëŠ” /static(í˜¹ì€ /public í˜¹ì€ /resource í˜¹ì€ /META-INF/resource) ê¸°ë°˜ìœ¼ë¡œ ì •ì  ì»¨í…ì¸ ë¥¼ ì œê³µí•œë‹¤. ìŠ¤í”„ë§MVCì˜ ResourceHttpRequestHandlerë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ WebMvcConfigureAdapterë¥¼ ì¶”ê°€í•˜ê³  addResourceHandler ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤.

ì•ì—ì„œ ì‚´í´ë³¸ ê¸°ë³¸ ì •ì  ìì› ìœ„ì¹˜ ì™¸ì—, Webjars content ë¥¼ ì‚¬ìš©í•˜ëŠ” íŠ¹ì´í•œ ê²½ìš°ê°€ ìˆë‹¤. Webjar í˜•íƒœë¡œ ë¬¶ì¸ jar íŒŒì¼ ì•ˆì— ìˆëŠ” /webjars/** ê²½ë¡œì— ìˆëŠ” ìì›ë“¤ì´ ì œê³µëœë‹¤.

íŒ: ì• í”Œë¦¬ì¼€ì´ì…˜ì„ jar ë¡œ ë¬¶ìœ¼ë ¤packaged í•œë‹¤ë©´ src/main/webapp í´ë”ëŠ” ì‚¬ìš©í•˜ì§€ ë§ì. ì´ í´ë”ëŠ” ì¼ë°˜ì ìœ¼ë¡œ, 'war' ë¬¶ìŒì¸ ê²½ìš°ì—ë§Œ ë™ì‘í•˜ë©°, ëŒ€ë¶€ë¶„ì˜ ë¹Œë“œíˆ´ì´ jar íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ê³¼ì •ì—ì„œ ì•”ë¬µì ìœ¼ë¡œ ë¬´ì‹œí•œë‹¤.

### Template engines

REST ì›¹ì„œë¹„ìŠ¤ê°€ ì˜ ë˜ì–´ ìˆë‹¤ë©´, ìŠ¤í”„ë§MVCë¥¼ ì´ìš©í•˜ì—¬ ë™ì ì¸ HTML ì»¨í…ì¸ ë¥¼ ì œê³µí•  ìˆ˜ ìˆë‹¤. ìŠ¤í”„ë§MVCëŠ” ë²¨ë¡œì‹œí‹°Velocity, í”„ë¦¬ë§ˆì»¤FreeMarker ê·¸ë¦¬ê³  JSP ë“±ì„ í¬í•¨í•œ ë‹¤ì–‘í•œ í…œí”Œë¦¿ ê¸°ìˆ ì„ ì§€ì›í•œë‹¤. ë‹¤ì–‘í•œ í…œí”Œë¦¿ ì—”ì§„ë“¤ì„ ìŠ¤í”„ë§MVCì™€ì˜ í†µí•©ëœë‹¤.

ìŠ¤í”„ë§ë¶€íŠ¸ëŠ” ë‹¤ìŒì˜ í…œí”Œë¦¿ ì—”ì§„ë“¤ì„ ì§€ì›í•˜ëŠ” ìë™ì„¤ì •ì„ í¬í•¨í•˜ê³  ìˆë‹¤:

- [í”„ë¦¬ë§ˆì»¤FreeMarker](http://freemarker.org/docs/)
- [ê·¸ë£¨ë¹„Groovy](http://beta.groovy-lang.org/docs/groovy-2.3.0/html/documentation/markup-template-engine.html)
- [íƒ€ì„ë¦¬í”„Thymeleaf](http://www.thymeleaf.org/)
- [ë²¨ë¡œì‹œí‹°Velocity](http://velocity.apache.org/)

ìœ„ì— ê±°ë¡ ëœ í…œí”Œë¦¿ ì—”ì§„ë“¤ ì¤‘ì—ì„œ í•œê°€ì§€ë¥¼ ê¸°ë³¸ì„¤ì •ìœ¼ë¡œ ì‚¬ìš©í•˜ë©°ëŠ, í…œí”Œë¦¿ë“¤ì€ src/main/resources/template ì—ì„œ ìë™ìœ¼ë¡œ ê°€ì ¸ì˜¨ë‹¤.

íŒ: JSPsëŠ” ê°€ëŠ¥í•˜ë©´, ë‚´ì¥í˜• ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•  ë•Œ ì•Œë ¤ì§„ ì—¬ëŸ¬ê°€ì§€ ì œì•½ì‚¬í•­ë“¤ì„ í”¼í•˜ê¸¸ ë°”ë€ë‹¤.

### ì˜¤ë¥˜ì œì–´ Error handling

ìŠ¤í”„ë§ë¶€íŠ¸ëŠ” /error ì™€ ë§¤ì¹­ë˜ëŠ” ë‹¤ì–‘í•œ ê²½ë¡œì˜ ëª¨ë“  ì—ëŸ¬ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆì— ë“±ë¡ëœ 'global' ì—ëŸ¬ í˜ì´ì§€ë¥¼ ì œì–´í•œë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” HTTP ìƒíƒœì™€ ì˜ˆì™¸ ë©”ì‹œì§€ ë“±ì˜ ì—ëŸ¬ì— ê´€í•œ ìì„¸í•œ ë‚´ìš©ì„ JSON ì‘ë‹µìœ¼ë¡œ ì œê³µë°›ì„ ìˆ˜ ìˆë‹¤. ë¸Œë¼ìš°ì €ì¸ ê²½ìš°ì—ëŠ” HTML í˜•íƒœì— ë™ì¼í•œ ë°ì´í„°ë¥¼ ê¸°ë¡í•œ Whitelabel!(ë³€ê²½í•˜ëŠ” ë°©ë²• í•˜ë ¤ë©´ 'error'ë¥¼ ì²˜ë¦¬í•˜ëŠ” viewë¥¼ ì¶”ê°€í•˜ë©´ ëœë‹¤) ì—ëŸ¬ ë·°ë¥¼ ë³´ê²Œëœë‹¤. ê¸°ë³¸ì ìœ¼ë¡œëŠ” ErrorControllerë¥¼ êµ¬í˜„í•˜ê³  ë¹ˆìœ¼ë¡œ ì •ì˜í•˜ë©´ ì™„ë²½íˆ ëŒ€ì²˜ê°€ ê°€ëŠ¥í•˜ë‹¤. í˜¹ì€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì½”ë“œì— ë”°ë¼ ErrorAttributes ë¹ˆì„ ê°„ë‹¨íˆ ì¶”ê°€í•  ìˆ˜ ìˆì§€ë§Œ ë‚´ìš©ì„ ëŒ€ì²´í•´ì•¼ í•œë‹¤.

    @Bean
    public EmbeddedServletContainerCustomizer containerCustomizer(){
        return new MyCustomizer();
    }
    
    // ...
    
    private static class MyCustomizer implements EmbeddedServletContainerCustomizer {
    
        @Override
        public void customize(ConfigurableEmbeddedServletContainer container) {
            container.addErrorPages(new ErrorPage(HttpStatus.BAD_REQUEST, "/400"));
        }
    
    }

ë˜í•œ @ExceptionHandler method ê·¸ë¦¬ê³  @ControllerAdvice ê°™ì€ ì¼ë°˜ì ì¸ ìŠ¤í”„ë§MVCì˜ ê¸°ëŠ¥ë“¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ErrorController ì œì–´ë˜ì§€ ì•ŠëŠ” ì˜ˆì™¸ë“¤ì„ ë‹¤ë£° ë•Œ ì‚¬ìš©í•œë‹¤.

Filterë¥¼ í†µí•´ ErrorPage ê²½ë¡œë¥¼ ë“±ë¡í•˜ì—¬ ì œì–´í•  ìˆ˜ë„ ìˆë‹¤(ì˜ˆë¡œ, Jersey ê·¸ë¦¬ê³  Wicket ê³¼ ê°™ì€ ë¹„ ìŠ¤í”„ë§ì›¹í”„ë ˆì„ì›Œí¬ì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©), FilterëŠ” ERROR ë””ìŠ¤íŒ¨ì³dispatcherì— ë“±ë¡ëœë‹¤. ì˜ˆ:

    // ì°¸ê³ : https://naning9.tistory.com/12
    // ê¸°ë³¸ì ìœ¼ë¡œ Spring bootì—ì„œëŠ” ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” filterê°€ ìë™ìœ¼ë¡œ ë™ì‘í•œë‹¤.
    ERROR [] --- ErrorPageFilter : Cannot forward to error page for request [/] as the response has already been committed. As a result, the 
    
    response may have the wrong status code. If your application is running on WebSphere Application Server
    
    you may be able to resolve this problem by setting com.ibm.ws.webcontainer.invokeFlushAfterService to false
    
    ---
    @Bean     
    public ErrorPageFilter errorPageFilter() {    
          return new ErrorPageFilter();    
    }  
    
    @Bean 
    public FilterRegistrationBean DisabledErrorPageFilter(ErrorPageFilter filter) { 
          FilterRegistrationBean filterRegistration = new FilterRegistrationBean<>(); 
          filterRegistration.setFilter(filter); 
          filterRegistration.setName("disabledErrorPageFilter"); 
          filterRegistration.setEnabled(false); 
          return filterRegistration; 
    }
    
    ---
    The bean 'ErrorPageFilter', defined in class path resource [ErrorPageRegistry.class], could not be registered. A bean with that name has already been defined in class path resource [ErrorPageFilter.class] and overriding is disabled.
    
    ---
    spring:
       main: 
         allow-bean-definition-overriding: true

ê¸°ë³¸ì ìœ¼ë¡œ FilterRegisterBeanëŠ” ERROR dispatcher íƒ€ì…ì— í¬í•¨ë˜ì§€ ì•ŠëŠ”ë‹¤

### JAX-RS ê·¸ë¦¬ê³  Jersey

EST ì—”ë“œí¬ì¸íŠ¸ë¥´ ìœ„í•´ì„œ JAX-RS í”„ë¡œê·¸ë˜ë° ëª¨ë¸ì„ ì°¸ì¡°í•˜ì—¬ ìŠ¤í”„ë§MVCë¥¼ ëŒ€ì²´í•  êµ¬í˜„ì²´ë¥¼ ì°¾ê³  ìˆë‹¤ë©´, ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ì— ë“±ë¡ë˜ëŠ” @Bean ì²˜ëŸ¼ Servletê³¼ Filterë¥¼ ë“±ë¡í•˜ë©´ Jersy 1.x ì™€ Apache Celtixì—ì„œë„ ì˜ ë™ì‘í•  ê²ƒì´ë‹¤. Jersey 2.x ëŠ” ìŠ¤í”„ë§ì„ ì§€ì›í•˜ê¸°ì— ìŠ¤í”„ë§ë¶€íŠ¸ ìŠ¤íƒ€í„°ì— ìë™ì„¤ì •ì„ ì œê³µí•˜ê³  ìˆë‹¤.

Jersey 2.x ì„ ì‹œì‘í•  ë•Œ spring-boot-starter-jersey ìŠ¤íƒ€í„°ì— ëŒ€í•œ ì˜ì¡´ì„±ì„ ì¶”ê°€í•˜ê³  ResourceConfig í˜•íƒœì˜ @Beanì´ í•˜ë‚˜ í•„ìš”í•˜ë©° ì—¬ê¸°ì— ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë“±ë¡í•˜ë©´ ëœë‹¤:

    @Component
    public class JerseyConfig extends ResourceConfig {
        public JerseyConfig() {
            register(Endpoint.class);
        }
    }

ë“±ë¡ëœ ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ì—ëŠ” HTTP ìì› ì• ë…¸í…Œì´ì…˜ ì¢…ë¥˜ì¸ @Component(ì˜ˆ: @GET) ê°€ ì„ ì–¸ë˜ì–´ì•¼ í•œë‹¤.

    @Component
    @Path("/hello")
    public class Endpoint {
    
        @GET
        public String message() {
            return "Hello";
        }
    
    }

### ë‚´ì¥í˜• ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ ì§€ì›

ìŠ¤í”„ë§ë¶€íŠ¸ëŠ” ë‚´ì¥í˜• í†°ìº£Tomcat, ì œí‹°Jetty, ê·¸ë¦¬ê³  ì–¸ë”í† ìš°Undertow ì„œë²„ë¥¼ ì§€ì›í•œë‹¤. ëŒ€ë¶€ë¶„ì˜ ê°œë°œìë“¤ì€ 'ìŠ¤íƒ€í„°Starter POM'ì„ í¬í•¨ì‹œí‚¤ëŠ” ê²ƒìœ¼ë¡œ ëª¨ë“  ì„¤ì •ì´ ë˜ì–´ ìˆì–´ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ë‚´ì¥ëœ ì„œë²„ì˜ ê¸°ë³¸ HTTP Request ì ‘ê·¼í¬íŠ¸ëŠ” 8080 ì´ë‹¤.

ì„œë¸”ë¦¿ ê·¸ë¦¬ê³  í•„í„°

ë‚´ì¥í˜• ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•  ë•Œ ìŠ¤í”„ë§ë¹ˆìœ¼ë¡œ ì„œë¸”ë¦¿ê³¼ í•„í„°ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë‹¤.

ServletRegistrationBean, FilterRegsitrationBean, ServletContextInitializer

EmbeddedWebApplicationContext

ìŠ¤í”„ë§ë¶€íŠ¸ëŠ” ë‚´ì¥í˜• ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆë¥¼ ì§€ì›í•˜ê¸° ìœ„í•´ ApplicationContextì˜ ìƒˆë¡œìš´ í˜•íƒœë¥¼ ì‚¬ìš©í•œë‹¤.

ë‚´ì¥í˜• ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ ë³€ê²½

- `server.port`Â - HTTP ìš”ì²­ ìˆ˜ìš© í¬íŠ¸
- `server.address`Â - ì—°ê²°ëœ ì¸í„°í˜ì´ìŠ¤ ì£¼ì†Œ
- `server.sessionTimeout`Â - ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ

í”„ë¡œê·¸ë˜ë°ìœ¼ë¡œ ë³€ê²½í•˜ê¸°

    import org.springframework.boot.context.embedded.*;
    import org.springframework.stereotype.Component;
    
    @Component
    public class CustomizationBean implements EmbeddedServletContainerCustomizer {
    
        @Override
        public void customize(ConfigurableEmbeddedServletContainer container) {
            container.setPort(9000);
        }
    
    }

ConfigurableEmbeddedServletContainer ì§ì ‘ ë³€ê²½

TomcatEmbeddedServletContainerFactory, 

JettyEmbeddedServletContainerFactory, 

UndertowEmbeddedServletContainerFactory

    @Bean
    public EmbeddedServletContainerFactory servletContainer() {
        TomcatEmbeddedServletContainerFactory factory = new TomcatEmbeddedServletContainerFactory();
        factory.setPort(9000);
        factory.setSessionTimeout(10, TimeUnit.MINUTES);
        factory.addErrorPages(new ErrorPage(HttpStatus.404, "/notfound.html");
        return factory;
    }

JSP ì œì•½ì‚¬í•­ 

ìŠ¤í”„ë§ë¶€íŠ¸ë¥¼ ì‹¤í–‰í•  ë•Œ ë‚´ì¥ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•œë‹¤ë©´(ì‹¤í–‰ê°€ëŠ¥í•œ ì••ì¶•íŒ¨í‚¤ì§€ë¼ë©´), JSP ì§€ì›ì´ ì œì•½ë˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤.

- í†°ìº£ì—ì„œ 'war' íŒ¨í‚¤ì§•ì„ ì‚¬ìš©í•œë‹¤ë©´, ì‹¤í–‰ê°€ëŠ¥í•œ warë¡œ ë™ì‘í•œë‹¤ë©´, í‘œì¤€ ì»¨í…Œì´ë„ˆì— ë°°í¬í•œë‹¤ë©´ ë³„ë‹¤ë¥¸ ë¬¸ì œëŠ” ì—†ì„ ê²ƒì´ë‹¤(ì œí•œì€ ì—†ë‹¤, í†°ìº£ì„ í¬í•¨í•´ì„œ). ì‹¤í–‰ê°€ëŠ¥í•œ jar ëŠ” í†°ìº£ì—ì„œ í•˜ë“œì½”ë“œ íŒŒì¼íŒ¨í„´ ë•Œë¬¸ì— ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ì œí‹°ëŠ” ë‚´ì¥ ì»¨í…Œì´ë„ˆì—ì„œ JSPë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ì–¸ë”í† ìš°ëŠ” JSPë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤.